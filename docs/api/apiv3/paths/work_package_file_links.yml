# /api/v3/work_packages/{id}/file_links
---
post:
  summary: Creates file links.
  operationId: Work_Package_Create_File_Links
  tags:
    - Work Packages
    - File links
  description: |-
    Creates file links on a work package.

    The request body must contain the generated storage token, and not the storage id. In addition, the request must
    send the origin file id and the stored meta data.
    
    If there is already a link on the given work package with the same file id, the previous data is not overwritten.
  parameters:
    - name: id
      description: Work package id
      in: path
      required: true
      schema:
        type: integer
      example: 1337
  requestBody:
    content:
      application/json:
        schema:
          type: object
          required:
            - storage
            - files
          properties:
            storage:
              type: string
              description: the storage token
            files:
              type: array
              items:
                type: object
                required:
                  - id
                  - name
                  - mimeType
                  - createdAt
                  - lastModifiedAt
                  - createdByName
                  - lastModifiedByName
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  mimeType:
                    type: string
                  createdAt:
                    type: string
                    format: date-time
                  lastModifiedAt:
                    type: string
                    format: date-time
                  createdByName:
                    type: string
                  lastModifiedByName:
                    type: string
          example:
            storage: e24fac19b889cc23b6f
            files:
              - id: 5503
                name: logo.png
                mimeType: image/png
                createdAt: '2022-01-18T12:01:37.302Z'
                lastModifiedAt: '2022-01-18T12:07:17.017Z'
                createdByName: Leia Organa
                lastModifiedByName: Anakin Skywalker
              - id: 5504
                name: README.md
                mimeType: text/plain
                createdAt: '2022-01-18T12:02:12.117Z'
                lastModifiedAt: '2022-01-18T12:02:12.117Z'
                createdByName: Bale Organa
                lastModifiedByName: Anakin Skywalker
  responses:
    '201':
      description: Created
      content:
        application/hal+json:
          schema:
            type: object
            required:
              - _type
              - count
              - total
              - _embedded
            properties:
              _type:
                type: string
                enum:
                  - Collection
              count:
                type: integer
                minimum: 0
              total:
                type: integer
                minimum: 0
              _embedded:
                type: object
                required:
                  - elements
                properties:
                  elements:
                    type: array
                    items:
                      $ref: '#/components/schemas/Work_Package_File_LinkModel'
    '400':
      content:
        application/hal+json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            _type: Error
            errorIdentifier: urn:openproject-org:api:v3:errors:InvalidRequestBody
            message: The request body was invalid.
      description: Occurs when the client did not send a valid JSON object in the request body.
    '403':
      content:
        application/hal+json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            _type: Error
            errorIdentifier: urn:openproject-org:api:v3:errors:MissingPermission
            message: You are not allowed to create file links of this work package.
      # TODO: specify permissions, will there be even any except from viewing the wp?
      description: |-
        Returned if the client does not have sufficient permissions.

        **Required permission:** edit work package

        *Note that you will only receive this error, if you are at least allowed to see the corresponding work package.*
    '404':
      content:
        application/hal+json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            _type: Error
            errorIdentifier: urn:openproject-org:api:v3:errors:NotFound
            message: The requested resource could not be found.
      description: |-
        Returned if the work package does not exist or the client does not have sufficient permissions to see it.

        **Required permission:** view work package
get:
  summary: Gets all file links of a work package
  operationId: Work_Package_Get_File_Links
  tags:
    - Work Packages
    - File links
  description: |-
    Gets all file links of a work package.

    The request can be filtered for the storage types and ids.
  parameters:
    - name: id
      description: Work package id
      in: path
      required: true
      schema:
        type: integer
      example: 1337
    - name: filters
      in: query
      required: false
      schema:
        type: string
      description: |-
        JSON specifying filter conditions.
        
        Accepts the same format as returned by the [queries](https://www.openproject.org/docs/api/endpoints/queries/) endpoint. Currently supported filters are:
        
        - storage_id: the identifier of a storage the file links refer to
        - storage_type: the type of a storage of file links
      example: '[{ "storage_type": { "operator": "=", "values": ["nextcloud"] } }]'
  responses:
    '200':
      description: OK
      content:
        application/hal+json:
          schema:
            type: object
            required:
              - _type
              - count
              - total
              - _embedded
            properties:
              _type:
                type: string
                enum:
                  - Collection
              count:
                type: integer
                minimum: 0
              total:
                type: integer
                minimum: 0
              _embedded:
                type: object
                required:
                  - elements
                properties:
                  elements:
                    type: array
                    items:
                      $ref: '#/components/schemas/Work_Package_File_LinkModel'
    '403':
      content:
        application/hal+json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            _type: Error
            errorIdentifier: urn:openproject-org:api:v3:errors:MissingPermission
            message: You are not allowed to create file links of this work package.
      # TODO: specify permissions, will there be even any except from viewing the wp?
      description: |-
        Returned if the client does not have sufficient permissions.
        
        **Required permission:** edit work package
        
        *Note that you will only receive this error, if you are at least allowed to see the corresponding work package.*
    '404':
      content:
        application/hal+json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            _type: Error
            errorIdentifier: urn:openproject-org:api:v3:errors:NotFound
            message: The requested resource could not be found.
      description: |-
        Returned if the work package does not exist or the client does not have sufficient permissions to see it.

        **Required permission:** view work package
